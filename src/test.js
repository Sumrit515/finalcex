const buyOrders = [
    {
        "id": "6521170c618313cbf1c49d53",
        "userId": "user_2UhUNduDhz2i0uaVCoqKsfzsIZ7",
        "price": "213.300",
        "placedAt": "2023-10-07T08:30:04.960Z",
        "type": "buy",
        "value": "0.2133",
        "quantity": "0.01",
        "tradeSymbolFirst": "bnb",
        "tradeSymbolSecond": "usdt",
        "status": "pending",
        "orderType": "market",
        "isCompleted": false
    }, 
    {
        "id": "6521170c618313cbf1c49d53",
        "userId": "user_2UhUNduDhz2i0uaVCoqKsfzsIZ8",
        "price": "214.300",
        "placedAt": "2023-10-07T08:30:04.960Z",
        "type": "buy",
       
        "quantity": "0.01",
        "tradeSymbolFirst": "bnb",
        "tradeSymbolSecond": "usdt",
        "status": "pending",
        "orderType": "market",
        "isCompleted": false
    }, 
    {
        "id": "6521170c618313cbf1c49d53",
        "userId": "user_2UhUNduDhz2i0uaVCoqKsfzsIZ9",
        "price": "213.300",
        "placedAt": "2023-10-07T08:30:04.960Z",
        "type": "buy",
   
        "quantity": "5.001",
        "tradeSymbolFirst": "bnb",
        "tradeSymbolSecond": "usdt",
        "status": "pending",
        "orderType": "market",
        "isCompleted": false
    }, 
    {
        "id": "6521170c618313cbf1c49d53",
        "userId": "user_2UhUNduDhz2i0uaVCoqKsfzsIZ10",
        "price": "213.300",
        "placedAt": "2023-10-07T08:30:04.960Z",
        "type": "buy",
        "quantity": "51",
        "tradeSymbolFirst": "bnb",
        "tradeSymbolSecond": "usdt",
        "status": "pending",
        "orderType": "market",
        "isCompleted": false
    }, 
    {
        "id": "6521170c618313cbf1c49d53",
        "userId": "user_2UhUNduDhz2i0uaVCoqKsfzsIZ11",
        "price": "216.300",
        "placedAt": "2023-10-07T08:30:04.960Z",
        "type": "buy",
        "quantity": "0.001",
        "tradeSymbolFirst": "bnb",
        "tradeSymbolSecond": "usdt",
        "status": "pending",
        "orderType": "market",
        "isCompleted": false
    }, 
    {
        "id": "6521170c618313cbf1c49d53",
        "userId": "user_2UhUNduDhz2i0uaVCoqKsfzsIZ12",
        "price": "214.300",
        "placedAt": "2023-10-07T08:30:04.960Z",
        "type": "buy",
        "quantity": "0.001",
        "tradeSymbolFirst": "bnb",
        "tradeSymbolSecond": "usdt",
        "status": "pending",
        "orderType": "market",
        "isCompleted": false
    }, 
    {
        "id": "6521170c618313cbf1c49d53",
        "userId": "user_2UhUNduDhz2i0uaVCoqKsfzsIZ13",
        "price": "213.300",
        "placedAt": "2023-10-07T08:30:04.960Z",
        "type": "buy",
        "quantity": "1",
        "tradeSymbolFirst": "bnb",
        "tradeSymbolSecond": "usdt",
        "status": "pending",
        "orderType": "market",
        "isCompleted": false
    }, 

]
const sellOrders = [
    {
        "id": "6521170c618313cbf1c49d53",
        "userId": "user_2UhUNduDhz2i0uaVCoqKsfzsIZ0",
        "price": "213.300",
        "placedAt": "2023-10-07T08:30:04.960Z",
        "type": "sell",
        "value": "0.2133",
        "quantity": "0.01",
        "tradeSymbolFirst": "bnb",
        "tradeSymbolSecond": "usdt",
        "status": "pending",
        "orderType": "market",
        "isCompleted": false
    }, 
    {
        "id": "6521170c618313cbf1c49d53",
        "userId": "user_2UhUNduDhz2i0uaVCoqKsfzsIZ1",
        "price": "214.300",
        "placedAt": "2023-10-07T08:30:04.960Z",
        "type": "sell",
       
        "quantity": "0.01",
        "tradeSymbolFirst": "bnb",
        "tradeSymbolSecond": "usdt",
        "status": "pending",
        "orderType": "market",
        "isCompleted": false
    }, 
    {
        "id": "6521170c618313cbf1c49d53",
        "userId": "user_2UhUNduDhz2i0uaVCoqKsfzsIZ2",
        "price": "213.300",
        "placedAt": "2023-10-07T08:30:04.960Z",
        "type": "sell",
   
        "quantity": "4.001",
        "tradeSymbolFirst": "bnb",
        "tradeSymbolSecond": "usdt",
        "status": "pending",
        "orderType": "market",
        "isCompleted": false
    }, 
    {
        "id": "6521170c618313cbf1c49d53",
        "userId": "user_2UhUNduDhz2i0uaVCoqKsfzsIZ3",
        "price": "213.300",
        "placedAt": "2023-10-07T08:30:04.960Z",
        "type": "sell",
        "quantity": "50",
        "tradeSymbolFirst": "bnb",
        "tradeSymbolSecond": "usdt",
        "status": "pending",
        "orderType": "market",
        "isCompleted": false
    }, 
    {
        "id": "6521170c618313cbf1c49d53",
        "userId": "user_2UhUNduDhz2i0uaVCoqKsfzsIZ4",
        "price": "216.300",
        "placedAt": "2023-10-07T08:30:04.960Z",
        "type": "sell",
        "quantity": "0.001",
        "tradeSymbolFirst": "bnb",
        "tradeSymbolSecond": "usdt",
        "status": "pending",
        "orderType": "market",
        "isCompleted": false
    }, 
    {
        "id": "6521170c618313cbf1c49d53",
        "userId": "user_2UhUNduDhz2i0uaVCoqKsfzsIZ5",
        "price": "214.300",
        "placedAt": "2023-10-07T08:30:04.960Z",
        "type": "sell",
        "quantity": "0.001",
        "tradeSymbolFirst": "bnb",
        "tradeSymbolSecond": "usdt",
        "status": "pending",
        "orderType": "market",
        "isCompleted": false
    }, 
    {
        "id": "6521170c618313cbf1c49d53",
        "userId": "user_2UhUNduDhz2i0uaVCoqKsfzsIZ6",
        "price": "213.300",
        "placedAt": "2023-10-07T08:30:04.960Z",
        "type": "sell",
        "quantity": "1",
        "tradeSymbolFirst": "bnb",
        "tradeSymbolSecond": "usdt",
        "status": "pending",
        "orderType": "market",
        "isCompleted": false
    }, 

]

const tradeBook = [

]

const matchOrder = () => {
  const newBuyOrders = buyOrders.sort((a, b) => Number(b.quantity) - Number(a.quantity))
  const newSellorders = sellOrders.sort((a, b) => Number(b.quantity) - Number(a.quantity))
let i =0;
while(newBuyOrders.length > 0 && newSellorders.length > 0){
    const bestBuyOrder = newBuyOrders[0]
    const bestSellOrder = newSellorders[0]

    if(Number(bestSellOrder.price) >= Number(bestBuyOrder.price)){
        const tradeQuantity = Math.min(Number(bestBuyOrder.quantity), Number(bestSellOrder.quantity))

        bestBuyOrder.quantity =( Number(bestBuyOrder.quantity) - tradeQuantity).toString()
        bestSellOrder.quantity = (Number(bestSellOrder.quantity) - tradeQuantity).toString()

        const trade = {
            buyer: bestBuyOrder.userId,
            seller: bestSellOrder.userId,
            price: bestBuyOrder.price,
            quantity: tradeQuantity
        }
        
        console.log(trade)

        tradeBook.push(trade)


        if(Number(bestBuyOrder.quantity) === 0){
            newBuyOrders.shift()
        }

        if(Number(bestSellOrder.quantity) === 0) {
            newSellorders.shift()
        }

    }else{
        i++
        
    }
}
  
console.log(tradeBook)
console.log(newBuyOrders)
console.log(newSellorders)
}
matchOrder()